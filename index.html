<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unvention Web</title>
    <link rel="icon" href="data:," />
    <link
      rel="stylesheet"
      href="src/ui/vanilla/styles/main.css?v=20260216-50"
    />
  </head>
  <body>
    <section
      id="auth-gate-screen"
      class="auth-gate-screen"
      aria-label="Sign in"
    >
      <div class="auth-gate-card">
        <h1>Unvention</h1>
        <p id="auth-login-status-line" class="mp-status-line">
          Checking authentication...
        </p>
        <label for="auth-login-email-input">Email</label>
        <input
          id="auth-login-email-input"
          type="email"
          placeholder="you@example.com"
          autocomplete="email"
        />
        <button id="auth-send-link" type="button">Send Magic Link</button>
        <p id="auth-login-feedback-line" class="mp-status-line"></p>
      </div>
    </section>
    <section
      id="new-game-screen"
      class="new-game-screen"
      aria-label="New game setup"
      style="display: none"
    >
      <aside class="home-sidebar">
        <div class="home-sidebar-container">
          <div>
            <h1 class="home-sidebar__title">Unvention</h1>
            <span class="signature">By Amir Aein</span>
          </div>
          <a
            id="home-sidebar-home"
            class="home-sidebar__nav-item"
            role="button"
            tabindex="0"
            data-action="hub-home-nav"
            ><svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              width="15px"
              margin-right="0.3rem"
            >
              <path
                d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1z"
              ></path>
              <polyline points="9 21 9 12 15 12 15 21"></polyline>
            </svg>
            Home</a
          >
          <div class="home-sidebar__rooms">
            <div class="home-sidebar__rooms-head">
              <strong>Rooms</strong>
              <div class="home-sidebar__rooms-actions">
                <button id="home-refresh-rooms" type="button">
                  Refresh <span style="font-size: 1rem">↺</span>
                </button>
              </div>
            </div>
            <p id="hub-profile-line" class="mp-status-line">
              Loading player history...
            </p>
            <div id="mp-hub-room-list" class="mp-hub-room-list"></div>
          </div>
        </div>
        <section
          id="home-auth-panel"
          class="home-auth-panel"
          aria-label="Authentication"
        >
          <div
            id="auth-home-display-name-row"
            class="home-auth-display-name-row"
          >
            <p id="auth-home-display-name-line" class="mp-status-line">
              Display name: Not set
            </p>
            <button id="auth-change-display-name" type="button">Change</button>
          </div>
          <p id="auth-home-status-line" class="mp-status-line">Not signed in</p>
          <button id="auth-logout" type="button" class="button-destructive">
            Log Out
          </button>
        </section>
      </aside>
      <main class="home-main">
        <div class="new-game-card">
          <section id="home-step-mode" class="mp-setup">
            <div class="home-create-grid home-create-grid--single">
              <section class="home-mp-panel">
                <h2>New Game</h2>
                <section
                  id="home-variable-setup-multiplayer"
                  class="variable-setup"
                >
                  <h3>Variable setup</h3>
                  <label
                    class="variable-setup__item"
                    for="var-setup-order-multiplayer"
                  >
                    <input
                      id="var-setup-order-multiplayer"
                      type="checkbox"
                      data-variable-setup-option="order"
                    />
                    <span>Randomize part location</span>
                  </label>
                  <label
                    class="variable-setup__item"
                    for="var-setup-idea-multiplayer"
                  >
                    <input
                      id="var-setup-idea-multiplayer"
                      type="checkbox"
                      data-variable-setup-option="idea"
                    />
                    <span>Start with additional idea</span>
                  </label>
                  <label
                    class="variable-setup__item"
                    for="var-setup-parts-multiplayer"
                  >
                    <input
                      id="var-setup-parts-multiplayer"
                      type="checkbox"
                      data-variable-setup-option="parts"
                    />
                    <span>Remove parts</span>
                  </label>
                </section>
                <label for="mp-seed" style="margin-bottom: -1rem"
                  >Seed (optional)</label
                >
                <input id="mp-seed" type="text" placeholder="e.g. XASDWAD" />

                <div class="mp-setup__buttons">
                  <button id="home-create-room" type="button">
                    Create a new game
                  </button>
                </div>
              </section>
            </div>
            <section id="mp-room-directory" class="home-mp-panel">
              <h2>Open Rooms</h2>
              <table class="mp-room-directory__table">
                <thead>
                  <tr>
                    <th>Room</th>
                    <th>Players</th>
                    <th>Status</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="mp-room-directory-body"></tbody>
              </table>
            </section>
          </section>
          <section
            id="home-step-room-list"
            class="mp-setup"
            style="display: none"
          >

            <h3 id="mp-hub-room-title">Select a room</h3>
            <p id="mp-hub-room-meta" class="mp-status-line">
              Pick a room from the sidebar.
            </p>
            <div class="mp-setup__buttons">
              <button id="home-room-open" type="button" class="mp-setup__buttons">Primary Action</button>
              <button
                id="home-room-abandon"
                type="button"
                class="button-destructive"
              >
                Abandon Game
              </button>
            </div>
            <p id="home-room-action-hint" class="mp-status-line"></p>
            <div id="mp-hub-room-summary" class="mp-hub-room-summary"></div>
            <table class="mp-room-directory__table">
              <thead>
                <tr>
                  <th>Player</th>
                  <th>Presence</th>
                  <th>Turn State</th>
                  <th>Score</th>
                  <th>Waiting</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="mp-hub-room-player-table-body"></tbody>
            </table>
          </section>
        </div>
      </main>
    </section>
    <main id="app-shell" class="app" style="display: none">
      <aside class="log-sidebar log-sidebar--collapsed" id="log-sidebar" aria-label="Action log">
        <button
          class="log-sidebar-toggle"
          id="log-sidebar-toggle"
          type="button"
          aria-label="Expand action log"
          aria-expanded="false"
        >
          <span class="log-sidebar-toggle-icon" aria-hidden="true">◀</span>
          <span class="log-sidebar-label" aria-hidden="true">Chat &amp; game log</span>
        </button>
        <div class="log-sidebar-inner">
          <div class="log-tab-hint">Hold <kbd class="kbd-tab">⇥ Tab</kbd> for game overview</div>
          <div class="log-header">
            <h2>Action Log</h2>
            <div class="log-header-actions">
              <button id="clear-log" type="button">Clear</button>
            </div>
          </div>
          <div class="log-filters">
            <div
              id="log-player-filter-tabs"
              class="log-player-tabs"
              role="tablist"
              aria-label="Log player filter"
            >
              <button
                type="button"
                class="log-player-tab log-player-tab--active"
                data-player-filter="all"
              >
                All
              </button>
            </div>
          </div>
          <ul id="log-list" class="log-list"></ul>
        </div>
      </aside>
      <!-- Hidden player-state-panel kept for JS compatibility -->
      <section id="player-state-panel" class="player-state-panel" aria-hidden="true" style="display:none">
        <div id="player-state-summary" class="player-state-summary"></div>
      </section>
      <section class="workspace">
        <div class="workspace-head">
          <div class="workspace-top-bar">
            <button id="back-to-lobby" type="button" class="workspace-back-btn">← Back to lobby</button>
            <button id="reset-game" type="button" class="button-destructive">Abandon Game</button>
          </div>
          <h1 class="workspace-title" id="workspace-title">Unvention</h1>
          <div class="workspace-actions">
            <div class="workspace-actions__left">
              <div id="phase-expectation" class="phase-expectation"></div>
              <div
                id="journal-controls"
                class="journal-controls journal-controls--header"
              ></div>
            </div>
            <div class="workspace-actions__right">
              <button id="advance-phase" type="button">Skip</button>
              <button id="undo-action" type="button" aria-label="Undo">
                ⤺ Undo
              </button>
            </div>
          </div>
        </div>

        <!-- Round roll kept hidden for JS compatibility -->
        <section
          id="round-roll-panel"
          class="round-roll-panel"
          aria-label="Current round roll"
          style="display:none"
        >
          <h2 id="round-roll-title">Turn -: Dice Groups</h2>
          <div id="round-roll-container" class="round-roll-container"></div>
        </section>

        <div class="game-panels-grid">
          <section
            id="journals-panel"
            class="journals-panel"
            aria-label="Player journals"
          >
            <h2>Journals</h2>
            <div
              id="journals-player-tabs"
              class="section-player-tabs"
              aria-label="Journal player tabs"
            ></div>
            <div id="journals-container" class="journals-container"></div>
          </section>
          <section
            id="inventions-panel"
            class="inventions-panel"
            aria-label="Player inventions"
          >
            <h2>Inventions</h2>
            <div
              id="inventions-player-tabs"
              class="section-player-tabs"
              aria-label="Invention player tabs"
            ></div>
            <div id="inventions-container" class="inventions-container"></div>
          </section>
          <section
            id="workshops-panel"
            class="workshops-panel"
            aria-label="Player workshops"
          >
            <h2>Workshops</h2>
            <div
              id="workshops-player-tabs"
              class="section-player-tabs"
              aria-label="Workshop player tabs"
            ></div>
            <div id="workshops-container" class="workshops-container"></div>
          </section>
          <section id="tools-panel" class="tools-panel" aria-label="Player tools">
            <h2>Tools</h2>
            <div
              id="tools-player-tabs"
              class="section-player-tabs"
              aria-label="Tool player tabs"
            ></div>
            <div id="tools-container" class="tools-container">
              <p class="tools-placeholder">Tool interactions coming next.</p>
            </div>
          </section>
        </div>
      </section>

      
    </main>
    <div
      id="game-hud-overlay"
      class="game-hud-overlay"
      role="dialog"
      aria-label="Game overview"
      aria-modal="true"
      style="display: none"
    >
      <div class="game-hud-overlay__header">
        <span class="game-hud-overlay__title">Game Overview</span>
        <span class="game-hud-overlay__hint">Release Tab to close</span>
      </div>
      <div id="game-hud-players" class="game-hud-players"></div>
    </div>
    <section
      id="auth-display-name-modal"
      class="auth-display-name-modal"
      aria-label="Set display name"
      role="dialog"
      aria-modal="true"
      style="display: none"
    >
      <div class="auth-display-name-modal__card">
        <h2 id="auth-display-name-modal-title">Set your display name</h2>
        <p class="mp-status-line">This name is shown to other players.</p>
        <label for="auth-display-name-input">Display name</label>
        <input
          id="auth-display-name-input"
          type="text"
          maxlength="24"
          autocomplete="nickname"
        />
        <button id="auth-display-name-save" type="button">Save</button>
        <p id="auth-display-name-feedback" class="mp-status-line"></p>
      </div>
    </section>
    <script src="src/shared/logLevels.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/core/ports/loggerPort.js"></script>
    <script src="src/core/ports/stateStorePort.js"></script>
    <script src="src/adapters/web/inMemoryLogger.js"></script>
    <script src="src/adapters/web/multiplayerClient.js?v=20260215-5"></script>
    <script src="src/adapters/web/localStorageStateStore.js"></script>
    <script src="src/core/services/loggerService.js"></script>
    <script src="src/core/services/gameStateService.js"></script>
    <script src="src/core/config/defaultRuleset.js"></script>
    <script src="src/core/services/setupPipelineService.js"></script>
    <script src="src/core/services/roundEngineService.js"></script>
    <script src="src/ui/vanilla/components/logSidebar.js?v=20260214-1"></script>
    <script src="src/app/container.js"></script>
    <script src="src/app/flows/homeModeFlow.js?v=20260216-15"></script>
    <script src="src/app/bootstrap.js?v=20260216-53"></script>
  </body>
</html>
